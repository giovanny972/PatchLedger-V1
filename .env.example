# Configuration PatchLedger MVP - Provider Cloud & Stockage

# =================================================================
# PROVIDER & RÉGION (Support multi-cloud étendu)
# =================================================================

# --- Providers supportés ---
PL_PROVIDER=ovh                  # ovh | scw | aws | gcp | azure | local

# --- Configuration OVH Cloud (recommandé EU) ---
PL_REGION=gra                    # OVH EU: gra|rbx|sbg|eu-west-par|de|uk|waw
                                # OVH CA: bhs|ca-east-tor
                                # OVH APAC: sgp|au-syd
PL_S3_ENDPOINT=https://s3.${PL_REGION}.io.cloud.ovh.net

# --- Configuration Scaleway (EU focus) ---
# PL_PROVIDER=scw
# PL_REGION=fr-par               # scw EU: fr-par|nl-ams|pl-waw
#                               # scw Global: fr-par|nl-ams|pl-waw
# PL_S3_ENDPOINT=https://s3.${PL_REGION}.scw.cloud

# --- Configuration AWS (Global) ---
# PL_PROVIDER=aws
# PL_REGION=eu-west-3           # AWS EU: eu-west-1|eu-west-2|eu-west-3|eu-central-1|eu-north-1
#                               # AWS US: us-east-1|us-east-2|us-west-1|us-west-2
#                               # AWS APAC: ap-southeast-1|ap-southeast-2|ap-northeast-1
# PL_S3_ENDPOINT=https://s3.${PL_REGION}.amazonaws.com

# --- Configuration Google Cloud Platform ---
# PL_PROVIDER=gcp
# PL_REGION=europe-west1        # GCP EU: europe-west1|europe-west2|europe-west3|europe-west4
#                               # GCP US: us-central1|us-east1|us-east4|us-west1
#                               # GCP APAC: asia-southeast1|asia-southeast2|asia-northeast1
# PL_S3_ENDPOINT=https://storage.googleapis.com

# --- Configuration Microsoft Azure ---
# PL_PROVIDER=azure
# PL_REGION=westeurope          # Azure EU: westeurope|northeurope|francecentral|germanywestcentral
#                               # Azure US: eastus|eastus2|westus|westus2|centralus
#                               # Azure APAC: southeastasia|eastasia|australiaeast
# PL_S3_ENDPOINT=https://${AZURE_STORAGE_ACCOUNT}.blob.core.windows.net

# --- Configuration Stockage Local (développement/test) ---
# PL_PROVIDER=local
# PL_REGION=local
# PL_S3_ENDPOINT=file:///var/backups/patchledger

# =================================================================
# CONFIGURATION AVANCÉE DU PROVIDER
# =================================================================

# Profile/Compte cloud à utiliser
PL_AWS_PROFILE=patchledger-${PL_REGION}

# Bucket/Container de stockage principal
PL_BUCKET=s3://patchledger-${PL_PROVIDER}-${PL_REGION}/${SITE_SLUG}/

# Configuration de rétention par provider
case "${PL_PROVIDER}" in
    "ovh")
        PL_RETENTION_DAYS=90
        PL_GLACIER_DAYS=30
        ;;
    "scw")
        PL_RETENTION_DAYS=60
        PL_GLACIER_DAYS=14
        ;;
    "aws")
        PL_RETENTION_DAYS=365
        PL_GLACIER_DAYS=90
        ;;
    "gcp")
        PL_RETENTION_DAYS=180
        PL_GLACIER_DAYS=60
        ;;
    "azure")
        PL_RETENTION_DAYS=120
        PL_GLACIER_DAYS=30
        ;;
    "local")
        PL_RETENTION_DAYS=30
        PL_GLACIER_DAYS=0
        ;;
esac

# =================================================================
# ENDPOINTS SPÉCIALISÉS PAR PROVIDER
# =================================================================

# --- OVH Cloud Storage ---
if [ "${PL_PROVIDER}" = "ovh" ]; then
    PL_SWIFT_ENDPOINT=https://auth.cloud.ovh.net/v3
    PL_SWIFT_REGION=${PL_REGION}
fi

# --- Scaleway Object Storage ---
if [ "${PL_PROVIDER}" = "scw" ]; then
    PL_SCW_ACCESS_KEY=${SCW_ACCESS_KEY}
    PL_SCW_SECRET_KEY=${SCW_SECRET_KEY}
    PL_SCW_PROJECT_ID=${SCW_PROJECT_ID}
fi

# --- AWS S3 ---
if [ "${PL_PROVIDER}" = "aws" ]; then
    AWS_DEFAULT_REGION=${PL_REGION}
    AWS_PROFILE=${PL_AWS_PROFILE}
fi

# --- Google Cloud Storage ---
if [ "${PL_PROVIDER}" = "gcp" ]; then
    GOOGLE_APPLICATION_CREDENTIALS=/etc/patchledger/gcp-service-account.json
    GOOGLE_CLOUD_PROJECT=${GCP_PROJECT_ID}
fi

# --- Azure Blob Storage ---
if [ "${PL_PROVIDER}" = "azure" ]; then
    AZURE_STORAGE_ACCOUNT=${AZURE_STORAGE_ACCOUNT}
    AZURE_STORAGE_KEY=${AZURE_STORAGE_KEY}
fi

# =================================================================
# CONFIGURATION RÉSEAU & SÉCURITÉ
# =================================================================

# Chiffrement en transit/repos
PL_ENCRYPTION_ENABLED=true
PL_ENCRYPTION_KEY_ID=${PL_PROVIDER}-kms-${PL_REGION}

# Configuration réseau
PL_VPC_ID=${PL_PROVIDER}-vpc-${PL_REGION}
PL_SUBNET_ID=${PL_PROVIDER}-subnet-${PL_REGION}-a

# Tags/Labels pour facturation et organisation
PL_TAGS="Environment=production,Service=patchledger,Region=${PL_REGION},Provider=${PL_PROVIDER}"

# =================================================================
# MONITORING & ALERTES
# =================================================================

# Endpoints de monitoring spécialisés
case "${PL_PROVIDER}" in
    "ovh")
        PL_METRICS_ENDPOINT=https://monitoring.${PL_REGION}.cloud.ovh.net
        ;;
    "scw")
        PL_METRICS_ENDPOINT=https://api.scaleway.com/cockpit/v1
        ;;
    "aws")
        PL_METRICS_ENDPOINT=https://monitoring.${PL_REGION}.amazonaws.com
        ;;
    "gcp")
        PL_METRICS_ENDPOINT=https://monitoring.googleapis.com
        ;;
    "azure")
        PL_METRICS_ENDPOINT=https://management.azure.com
        ;;
esac

# Seuils d'alerte
PL_ALERT_STORAGE_THRESHOLD_GB=1000
PL_ALERT_BANDWIDTH_THRESHOLD_GB=500
PL_ALERT_API_CALLS_THRESHOLD=10000

# =================================================================
# EXEMPLES DE CONFIGURATION RAPIDE
# =================================================================

# Exemple configuration OVH Gravelines (recommandé France)
# PL_PROVIDER=ovh PL_REGION=gra

# Exemple configuration Scaleway Paris (économique France)
# PL_PROVIDER=scw PL_REGION=fr-par

# Exemple configuration AWS Frankfurt (enterprise Europe)
# PL_PROVIDER=aws PL_REGION=eu-central-1

# Exemple configuration multi-région (sauvegarde géo-distribuée)
# PL_PROVIDER_PRIMARY=ovh PL_REGION_PRIMARY=gra
# PL_PROVIDER_SECONDARY=scw PL_REGION_SECONDARY=nl-ams